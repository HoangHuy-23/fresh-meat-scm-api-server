version: "3.9"

services:
  api:
    build: .
    container_name: fresh-meat-scm-api-server
    restart: unless-stopped
    user: "0" # run as root to read host-mounted Fabric crypto files with restrictive permissions
    env_file:
      - .env
    environment:
      GIN_MODE: ${GIN_MODE:-release}
      PORT: ${SERVER_PORT:-8080}
    # Expose API port for local access (effective if not using host network mode)
    ports:
      - "${SERVER_PORT:-8080}:8080"
    extra_hosts:
      - "host.docker.internal:host-gateway"
    volumes:
      - ./config/config.yaml:/srv/app/config/config.yaml:ro
      - ./connection-profile.yaml:/srv/app/connection-profile.yaml:ro
      # Mount Fabric crypto materials so absolute paths used by code resolve inside container
      - /home/lean1123/fresh-meat-scm-hyperledger-fabric:/home/lean1123/fresh-meat-scm-hyperledger-fabric:ro
